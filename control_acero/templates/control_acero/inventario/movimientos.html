{% extends 'control_acero/layout.html' %}
{% block title_module %}
	MOVIMIENTOS ENTRADAS - SALIDAS
{% endblock %}
{% block modals %}
<!-- Modal -->
<div class="modal fade" id="modalPdf" tabindex="-1" role="dialog" aria-labelledby="modalPdfLabel">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="modalPdfLabel">Impresion PDF</h4>
			</div>
			<div class="modal-body">
				<iframe class="col-lg-12 col-md-12 col-sm-12" height="600" name="framePdf" id="framePdf"></iframe>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
{% endblock %}
{% block content %}
	<div class="col-xs-12">
		<div class="col-md-12">
				
			<div class="form-group col-md-12">
				<label  class="control-label" for="cmbFrente">Elegir Frente de trabajo:</label>
				<select name="cmbFrente" id="cmbFrente" class="cmbFrente form-control">
				</select>
			</div>

		</div>
		<div class="col-md-12">
			<button type="button" class="btn btn-success" name="seleccionarFrente" id="seleccionarFrente">Seleccionar</button>
		</div>
		<div style="display:none;" id="divFrente" class="col-md-12 table-responsive">
			<table id="tablaFrente" class="table table-hover">
				<thead>
					<tr>
						<th class="text-center">Nombre del Frente</th>
						<th class="text-center">Identificación del Tramo</th>
						<th class="text-center">Ubicación</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div style="display:none;" id="divDetalleMovimientos" class="col-md-6 text-center">
					<button type="button" class="btn btn-success" name="btnSolicitar" id="btnSolicitar">Revisar</button>
		</div>
		<!-- <div style="display:none;" id="divApoyo" class="col-md-12">
			<div class="form-group col-md-12">
				<label  class="control-label" for="cmbApoyo">Elegir Apoyo:</label>
				<select name="cmbApoyo" id="cmbApoyo" class="cmbApoyo form-control">
				</select>
			</div>
			<div class="form-group col-md-12">
				<label  class="control-label" for="cmbElemento">Elegir Elemento:</label>
				<select name="cmbElemento" id="cmbElemento" class="cmbElemento form-control">
				</select>
			</div>
		</div> -->
		
		<div style="display:none;" id="divDetalle" class="col-md-12 table-responsive">
			<table id="tablaMovimientos" class="table table-hover">
				<thead>
					<tr>
						<th class="text-center">Apoyo</th>
						<th class="text-center">Elemento</th>
						<th class="text-center">Proveedor</th>
						<th class="text-center">Entrada</th>
						<th class="text-center">Salida</th>
						<th class="text-center">Detalle</th>
						<th class="text-center">Etapa</th>
						<th class="text-center">Acciones</th>
					</tr>
				</thead>
				
				<tbody>
					
				</tbody>
			</table>
		</div>
		
	</div>
	<script type="text/javascript">
		comboFrente = function () {
		    $.ajax({
		        type: "POST",
		        url: "/control_acero/frente/combofiltrado/",
		        async: false,
		        dataType: "json",
		        data: {csrfmiddlewaretoken: csrftoken
						},
		        beforeSend: function (objeto) {
		        },
		        success: function (datos) {
		            try {
		                $('.cmbFrente').empty();
		                $('.cmbFrente').append('<option value="0">Selecciona un Frente de Trabajo</option>');
	                    $.each(datos.data, function (count, object) {
	                        $('.cmbFrente').append('<option value="' + object.idFrente + '">' + object.nombre + '</option>');
	                    });
		            } catch (e) {
		                alert("Error al cargar Combo Frente:" + e);
		            }
		        },
		        error: function (objeto, quepaso, otroobj) {
		            alert("Error en la peticion de Combo Frente:\n\n" + otroobj);
		        }
		    });
		};
		$( "#seleccionarFrente" ).click(function() {
			$("#tablaFrente tbody").empty();
			var frente = $("#cmbFrente").val();
			if(frente == 0){
				mensajeWarning("<b>Debes elegir un Frente de Trabajo.</b>");
				return false;
			}
			
			var tabla = '';
		    $.ajax({
		        type: "POST",
		        url: "/control_acero/frenteTrabajo/show/",
		        async: false,
		        dataType: "json",
		        data: {csrfmiddlewaretoken: csrftoken,
		        		idFrente: frente
						},
		        beforeSend: function (objeto) {
		        },
		        success: function (datos) {
		            try {
	                    $.each(datos.data, function (count, object) {
	                        tabla += '<tr>'
	                        			+'<td>'+object.nombreFrente+'</td>'
	                        			+'<td>'+object.identificacion+'</td>'
	                        			+'<td>'+object.ubicacion+'</td>'
	                        		+'</tr>';
	                    });
		            } catch (e) {
		                alert("Error al cargar El Frente:" + e);
		            }
		        },
		        error: function (objeto, quepaso, otroobj) {
		            alert("Error en la peticion del Frente:\n\n" + otroobj);
		        }
		    });
		    $("#tablaFrente tbody").append(tabla);
		    $("#divFrente").show("slide");
		    $("#divDetalleMovimientos").show("slide");
		   
		});

		$( "#divDetalleMovimientos" ).click(function() {
			$("#tablaMovimientos tbody").empty();
			var movimientos = $("#cmbDetalle").val();
			var frente =$("#cmbFrente").val();
			var tabla = '';
		    $.ajax({
		        type: "POST",
		        url: "/control_acero/inventario/movimientos/show/",
		        async: false,
		        dataType: "json",
		        data: {csrfmiddlewaretoken: csrftoken,
		        		idFrente: frente
						},


		        beforeSend: function (objeto) {
		        },
		        success: function (datos) {
		            try {
	                    $.each(datos.data, function (count, object) {
	                        tabla += '<tr>'
	                        			+'<td>'+object.pesoSolicitado+'</td>'
	                        			+'<td>'+object.pesoRecibido+'</td>'
	                        			+'<td>'+object.tipoRecepcion+'</td>'
	                        			+'<td>'+object.frente+'</td>'
	                        			+'<td>'+object.apooyo+'</td>'
	                        			+'<td>'+object.elemento+'</td>'

	                        			+'<td>'+object.funcionProveedor+'</td>'

	                        			+'<td>'+object.tipoRecepcion+'</td>'

	                        			+'<td>'+object.estatusEtapa+'</td>'

	                        			+'<td>'+object.programaId+'</td>'
	                        		+'</tr>';
	                    });
		            } catch (e) {
		                alert("Error al cargar :" + e);
		            }
		        },
		        error: function (objeto, quepaso, otroobj) {
		            alert("Error en la peticion:\n\n" + otroobj);
		        }
		    });

		     $("#tablaMovimientos tbody").append(tabla);
		    $("#divDetalle").show("slide");
		    $("#divDetalleMovimientos").show("slide");
		   
		});
		


			$("#btnCancelar" ).click(function() {
			$("#cmbFrente").val(0);
			$("#divDetalleMovimientos").hide('slide');
		    
		});
	    $(function () {
	    	comboFrente();
	    	//comboApoyo();
	    });
	</script>
{% endblock %}